---
title: 'Final Project'
author: "Devansh Agarwal"
date: 'Due Date: 12/14/2020'
output:
  html_notebook:
    df_print: paged
  html_document:
    df_print: paged
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```


```{r}
# Libraries

library(genius)
library(tidyverse)
library(qdap)
library(tidytext)
library(rvest)
```

```{r}
# Data Scraping

page = "https://en.wikipedia.org/wiki/Grammy_Award_for_Record_of_the_Year"

XPATHgen = "/html/body/div[3]/div[3]/div[5]/div[1]/table"

Music <- data.frame()

for (i in 5:8){ # Loop for each decade
  # Scrape website
  Temp <- page %>% 
    read_html() %>%
    html_nodes(xpath = paste(XPATHgen,'[',i,']',sep = '')) %>%
    html_table(fill = TRUE)
  Music <- rbind(Music,Temp[[1]])
}

rm(Temp,i,page,XPATHgen) # Remove unneeded objects from Environment 
```


```{r}
# Data Cleaning

MusicCleaned <- 
  Music %>% 
  na.omit() %>% # Remove NAs
  transmute( 
    year = gsub(pattern = '(\\[\\d+\\])',replacement = '',x = `Year[I]`), # Remove foot notes
    track = Record,
    artist = `Artist(s)`
  ) %>%
  mutate(
    decade = paste(substr(year,1,3),'0s',sep = '')
  )

rm(Music)

# Add Lyrics and write to CSV file

Lyrics <- 
  MusicCleaned %>%
  add_genius(artist, track, type = "lyrics")

write.csv(Lyrics,'Lyric.csv')
```

```{r}
# Read data back in 

Lyrics <- read.csv("Lyric.csv", sep = ",", header=T)

Songs <- 
  Lyrics %>%
  group_by(track,artist,year) %>%
  summarise(
    lines = n()
  )

```

